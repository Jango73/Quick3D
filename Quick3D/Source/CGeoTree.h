
#pragma once

// Qt
#include <QImage>
#include <QDateTime>

// Application
#include "quick3d_global.h"
#include "CQ3DConstants.h"
#include "CGeoloc.h"
#include "CBoundingBox.h"

//-------------------------------------------------------------------------------------------------

template<class T>
class QUICK3D_EXPORT CGeoTreeItem
{
public:

    //-------------------------------------------------------------------------------------------------
    // Constructors and destructor
    //-------------------------------------------------------------------------------------------------

    //!
    CGeoTreeItem(CGeoloc gGeoloc, CGeoloc gSize, int iMaxLevel, int iLevel);

    //!
    virtual ~CGeoTreeItem();

    //-------------------------------------------------------------------------------------------------
    // Getters
    //-------------------------------------------------------------------------------------------------

    //!
    CGeoloc geoloc() const { return m_gGeoloc; }

    //!
    CGeoloc size() const { return m_gSize; }

    //-------------------------------------------------------------------------------------------------
    // Control methods
    //-------------------------------------------------------------------------------------------------

    //!
    void append(const CGeoloc& gGeoloc, T data);

    //!
    void query(QVector<T>& vResults, const CGeoloc& gPosition, double dRadius_m);

protected:

    //-------------------------------------------------------------------------------------------------
    // Properties
    //-------------------------------------------------------------------------------------------------

    int                         m_iLevel;
    CGeoloc                     m_gGeoloc;
    CGeoloc                     m_gSize;
    QVector<T>                  m_vData;
    QVector<CGeoTreeItem<T>*>   m_vChildren;
};

//-------------------------------------------------------------------------------------------------

template<class T>
class QUICK3D_EXPORT CGeoTree
{
public:

    //-------------------------------------------------------------------------------------------------
    // Constructors and destructor
    //-------------------------------------------------------------------------------------------------

    //!
    CGeoTree(int iLevels = 5);

    //!
    virtual ~CGeoTree();

    //-------------------------------------------------------------------------------------------------
    // Setters
    //-------------------------------------------------------------------------------------------------

    //-------------------------------------------------------------------------------------------------
    // Getters
    //-------------------------------------------------------------------------------------------------

    //!
    int levels() const { return m_iLevels; }

    //-------------------------------------------------------------------------------------------------
    // Control methods
    //-------------------------------------------------------------------------------------------------

    //!
    void append(const CGeoloc& gGeoloc, T data);

    //!
    QVector<T> query(const CGeoloc& gGeoloc, double dRadius_m);

    //-------------------------------------------------------------------------------------------------
    // Protected methods
    //-------------------------------------------------------------------------------------------------

protected:

    //!
    void build();

    //-------------------------------------------------------------------------------------------------
    // Properties
    //-------------------------------------------------------------------------------------------------

protected:

    int                 m_iLevels;
    CGeoTreeItem<T>*    m_pRoot;
};
